<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Wyb√≥r logotypu firmy</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    html, body {
      height: 100%;
      width: 100%;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #f9fafb;
      display: flex;
      flex-direction: column;
    }

    header {
      padding: 8px 16px;
      background: #020617;
      box-shadow: 0 2px 6px rgba(0,0,0,0.4);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 8px;
      z-index: 10;
    }

    .header-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    header h1 {
      font-size: 1.3rem;
      margin: 0;
    }

    header p {
      font-size: 0.85rem;
      opacity: 0.9;
    }

    #progress {
      color: #38bdf8;
      font-weight: 600;
    }

    #restartBtn {
      border: none;
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      background: #f97316;
      color: #111827;
      transition: 0.2s;
      box-shadow: 0 2px 8px rgba(0,0,0,0.4);
    }

    #restartBtn:hover {
      transform: scale(1.05);
      filter: brightness(1.05);
    }

    .grid-wrapper {
      flex: 1;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 4px;
      min-height: 0;
    }

    /* Dynamiczna siatka 2x2 */
    #grid {
      width: 100%;
      height: 100%;
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 6px;
    }

    .logo-card {
      background: #0b1120;
      border-radius: 12px;
      overflow: hidden;
      border: 2px solid #1e293b;
      cursor: pointer;
      box-shadow: 0 3px 16px rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .logo-card:hover {
      transform: scale(1.03);
      border-color: #38bdf8;
      box-shadow: 0 4px 24px rgba(0,0,0,0.8);
    }

    /* Zachowuje oryginalne proporcje i dopasowuje do dostƒôpnej przestrzeni */
    .logo-card img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      object-position: center;
    }

    #results {
      padding: 16px;
      background: #020617;
      border-top: 1px solid #1f2937;
    }

    #results p {
      margin-bottom: 6px;
      font-size: 0.95rem;
    }

    #results img {
      vertical-align: middle;
      margin-left: 8px;
      border-radius: 6px;
      background: #0b1120;
      max-height: 80px;
    }

    #status {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-top: 6px;
    }

    /* Responsywno≈õƒá */
    @media (max-width: 800px) {
      #grid {
        grid-template-columns: 1fr;
        grid-template-rows: repeat(4, 1fr);
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-text">
      <h1>Wyb√≥r logotypu firmy</h1>
      <p id="instructions">Etap 1 z 3: wybierz najlepszy logotyp spo≈õr√≥d 4. (Zestaw 1 z 48)</p>
      <p id="progress">Pozosta≈Ço klikniƒôƒá: 64</p>
    </div>
    <button id="restartBtn">üîÅ Zacznij od poczƒÖtku</button>
  </header>

  <div class="grid-wrapper">
    <div id="grid"></div>
  </div>

  <div id="results">
    <div id="status"></div>
  </div>

  <script>
    // üîß KONFIGURACJA BACKENDU (Google Apps Script)
    const ENDPOINT_URL = 'https://script.google.com/macros/s/AKfycbxjceZCcOlnR2ojKd78YZaWVUGO4akZyPJbVajfo1H6czaUFWnOYP7Pw3weAdsYez-'; // <- Wklej sw√≥j URL

    // üîß KONFIGURACJA KONKURSU
    const IMAGE_COUNT = 192;
    const TOTAL_CLICKS = 48 + 12 + 4;

    // Generowanie listy nazw plik√≥w
    const MASTER_LOGOS = Array.from({ length: IMAGE_COUNT }, (_, i) => `logos/logo (${i + 1}).png`);

    // ZMIENNE STANU
    let allLogos = [];
    let stage = 1;
    let round = 0;
    let winners48 = [];
    let winners12 = [];
    let final4 = [];
    let ranking = [];
    let clickCount = 0;
    let sessionId = '';

    const grid = document.getElementById("grid");
    const instructionsEl = document.getElementById("instructions");
    const progressEl = document.getElementById("progress");
    const resultsEl = document.getElementById("results");
    const statusEl = document.getElementById("status");

    // --- Pomocnicze ---
    function shuffle(array) {
      return array.map(v => ({ v, sort: Math.random() }))
        .sort((a, b) => a.sort - b.sort)
        .map(({ v }) => v);
    }

    function setInstructions(text) {
      instructionsEl.textContent = text;
    }

    function updateProgress() {
      const remaining = TOTAL_CLICKS - clickCount;
      progressEl.textContent = `Pozosta≈Ço klikniƒôƒá: ${remaining}`;
    }

    function renderRound(group, onChoose) {
      grid.innerHTML = "";
      group.forEach(src => {
        const card = document.createElement("div");
        card.className = "logo-card";
        const img = document.createElement("img");
        img.src = src;
        img.alt = "";
        card.appendChild(img);
        card.onclick = () => onChoose(src);
        grid.appendChild(card);
      });
    }

    // --- Wysy≈Çanie wynik√≥w do Google Sheets ---
    function sendResultsToServer() {
      if (!ENDPOINT_URL.includes('https://script.google.com/')) {
        statusEl.textContent = '‚ö† Brak skonfigurowanego endpointu do wysy≈Çki.';
        return;
      }

      const payload = { sessionId, ranking, clickCount };

      statusEl.textContent = 'üì§ Wysy≈Çanie wynik√≥w...';
      fetch(ENDPOINT_URL, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
        .then(r => r.text())
        .then(() => statusEl.textContent = '‚úÖ Wyniki zosta≈Çy zapisane w arkuszu.')
        .catch(err => {
          console.error(err);
          statusEl.textContent = '‚ö† Nie uda≈Ço siƒô wys≈Çaƒá wynik√≥w.';
        });
    }

    // --- Etapy konkursu ---
    function nextStage1() {
      if (round >= 48) return startStage2();
      setInstructions(`Etap 1 z 3: wybierz najlepszy logotyp spo≈õr√≥d 4. (Zestaw ${round + 1} z 48)`);
      const group = allLogos.slice(round * 4, round * 4 + 4);
      renderRound(group, (chosen) => {
        winners48.push(chosen);
        clickCount++;
        updateProgress();
        round++;
        nextStage1();
      });
    }

    function startStage2() {
      stage = 2; round = 0;
      setInstructions("Etap 2 z 3: z 48 logotyp√≥w wybierzesz 12 zwyciƒôzc√≥w (po 4 w rundzie).");
      nextStage2();
    }

    function nextStage2() {
      if (round >= 12) return startStage3();
      const group = shuffle(winners48).slice(0, 4);
      setInstructions(`Etap 2 z 3: wybierz najlepszy logotyp spo≈õr√≥d 4. (Runda ${round + 1} z 12)`);
      renderRound(group, (chosen) => {
        winners12.push(chosen);
        clickCount++;
        updateProgress();
        round++;
        nextStage2();
      });
    }

    function startStage3() {
      stage = 3; round = 0;
      final4 = shuffle(winners12).slice(0, 4);
      ranking = [];
      setInstructions("Etap 3 z 3: wybierz kolejno 4 najlepsze logotypy (klikniƒôcie = miejsce 1, 2, 3, 4).");
      renderRound(final4, (chosen) => {
        if (!ranking.includes(chosen)) ranking.push(chosen);
        clickCount++;
        updateProgress();
        if (ranking.length === 4) showResults();
        else setInstructions(`Wybierz logotyp na miejsce ${ranking.length + 1}`);
      });
    }

    function showResults() {
      grid.innerHTML = "";
      setInstructions("Wynik ko≈Ñcowy ‚Äì Twoje TOP 4 logotypy:");
      updateProgress();
      resultsEl.innerHTML = ranking.map((src, i) =>
        `<p><strong>Miejsce ${i + 1}:</strong> ${src} <img src="${src}"></p>`
      ).join("") + `<div id="status"></div>`;
      sendResultsToServer();
    }

    function restartAll() {
      stage = 1;
      round = 0;
      winners48 = [];
      winners12 = [];
      final4 = [];
      ranking = [];
      clickCount = 0;
      sessionId = 'sess-' + Date.now() + '-' + Math.random().toString(36).slice(2);
      allLogos = shuffle([...MASTER_LOGOS]);
      resultsEl.innerHTML = '<div id="status"></div>';
      setInstructions("Etap 1 z 3: wybierz najlepszy logotyp spo≈õr√≥d 4. (Zestaw 1 z 48)");
      updateProgress();
      nextStage1();
    }

    document.getElementById("restartBtn").onclick = restartAll;

    restartAll();
  </script>
</body>
</html>
